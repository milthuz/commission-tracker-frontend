import { useEffect, useRef, useState } from 'react';
import { Link } from 'react-router-dom';

const DropdownHelp = () => {
  const [dropdownOpen, setDropdownOpen] = useState(false);

  const trigger = useRef<any>(null);
  const dropdown = useRef<any>(null);

  useEffect(() => {
    const clickHandler = ({ target }: MouseEvent) => {
      if (!dropdown.current) return;
      if (
        !dropdownOpen ||
        dropdown.current.contains(target) ||
        trigger.current.contains(target)
      )
        return;
      setDropdownOpen(false);
    };
    document.addEventListener('click', clickHandler);
    return () => document.removeEventListener('click', clickHandler);
  });

  useEffect(() => {
    const keyHandler = ({ keyCode }: KeyboardEvent) => {
      if (!dropdownOpen || keyCode !== 27) return;
      setDropdownOpen(false);
    };
    document.addEventListener('keydown', keyHandler);
    return () => document.removeEventListener('keydown', keyHandler);
  });

  return (
    <li className="relative">
      <Link
        ref={trigger}
        onClick={() => setDropdownOpen(!dropdownOpen)}
        to="#"
        className="relative flex h-8.5 w-8.5 items-center justify-center rounded-full border-[0.5px] border-stroke bg-gray hover:text-primary dark:border-strokedark dark:bg-meta-4 dark:text-white"
      >
        <svg
          className="fill-current"
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M16.1999 9.30001H15.5999C15.3999 9.30001 15.2999 9.10001 15.2999 8.90001C15.2999 8.70001 15.2999 8.50001 15.2999 8.30001C15.2999 8.10001 15.3999 7.90001 15.5999 7.90001H16.1999C16.5999 7.90001 16.9999 7.50001 16.9999 7.10001V6.50001C16.9999 6.10001 16.5999 5.70001 16.1999 5.70001H15.5999C15.3999 5.70001 15.2999 5.50001 15.2999 5.30001C15.2999 5.10001 15.2999 4.90001 15.2999 4.70001C15.2999 4.50001 15.3999 4.30001 15.5999 4.30001H16.1999C16.5999 4.30001 16.9999 3.90001 16.9999 3.50001V2.90001C16.9999 2.50001 16.5999 2.10001 16.1999 2.10001H15.5999C15.3999 2.10001 15.2999 1.90001 15.2999 1.70001C15.2999 1.50001 15.0999 1.30001 14.8999 1.30001H14.2999C13.8999 1.30001 13.4999 1.70001 13.4999 2.10001V2.70001C13.4999 2.90001 13.2999 3.00001 13.0999 3.00001C12.8999 3.00001 12.6999 3.00001 12.4999 3.00001C12.2999 3.00001 12.0999 2.90001 12.0999 2.70001V2.10001C12.0999 1.70001 11.6999 1.30001 11.2999 1.30001H10.6999C10.2999 1.30001 9.89991 1.70001 9.89991 2.10001V2.70001C9.89991 2.90001 9.69991 3.00001 9.49991 3.00001C9.29991 3.00001 9.09991 3.00001 8.89991 3.00001C8.69991 3.00001 8.49991 2.90001 8.49991 2.70001V2.10001C8.49991 1.70001 8.09991 1.30001 7.69991 1.30001H7.09991C6.69991 1.30001 6.29991 1.70001 6.29991 2.10001V2.70001C6.29991 2.90001 6.09991 3.00001 5.89991 3.00001C5.69991 3.00001 5.49991 3.00001 5.29991 3.00001C5.09991 3.00001 4.89991 2.90001 4.89991 2.70001V2.10001C4.89991 1.70001 4.49991 1.30001 4.09991 1.30001H3.49991C3.09991 1.30001 2.69991 1.70001 2.69991 2.10001V2.70001C2.69991 2.90001 2.49991 3.00001 2.29991 3.00001H1.69991C1.29991 3.00001 0.899902 3.40001 0.899902 3.80001V4.40001C0.899902 4.80001 1.29991 5.20001 1.69991 5.20001H2.29991C2.49991 5.20001 2.59991 5.40001 2.59991 5.60001C2.59991 5.80001 2.59991 6.00001 2.59991 6.20001C2.59991 6.40001 2.49991 6.60001 2.29991 6.60001H1.69991C1.29991 6.60001 0.899902 7.00001 0.899902 7.40001V8.00001C0.899902 8.40001 1.29991 8.80001 1.69991 8.80001H2.29991C2.49991 8.80001 2.59991 9.00001 2.59991 9.20001C2.59991 9.40001 2.59991 9.60001 2.59991 9.80001C2.59991 10 2.49991 10.2 2.29991 10.2H1.69991C1.29991 10.2 0.899902 10.6 0.899902 11V11.6C0.899902 12 1.29991 12.4 1.69991 12.4H2.29991C2.49991 12.4 2.59991 12.6 2.59991 12.8C2.59991 13 2.79991 13.2 2.99991 13.2H3.59991C3.99991 13.2 4.39991 12.8 4.39991 12.4V11.8C4.39991 11.6 4.59991 11.5 4.79991 11.5C4.99991 11.5 5.19991 11.5 5.39991 11.5C5.59991 11.5 5.79991 11.6 5.79991 11.8V12.4C5.79991 12.8 6.19991 13.2 6.59991 13.2H7.19991C7.59991 13.2 7.99991 12.8 7.99991 12.4V11.8C7.99991 11.6 8.19991 11.5 8.39991 11.5C8.59991 11.5 8.79991 11.5 8.99991 11.5C9.19991 11.5 9.39991 11.6 9.39991 11.8V12.4C9.39991 12.8 9.79991 13.2 10.1999 13.2H10.7999C11.1999 13.2 11.5999 12.8 11.5999 12.4V11.8C11.5999 11.6 11.7999 11.5 11.9999 11.5C12.1999 11.5 12.3999 11.5 12.5999 11.5C12.7999 11.5 12.9999 11.6 12.9999 11.8V12.4C12.9999 12.8 13.3999 13.2 13.7999 13.2H14.3999C14.7999 13.2 15.1999 12.8 15.1999 12.4V11.8C15.1999 11.6 15.3999 11.5 15.5999 11.5H16.1999C16.5999 11.5 16.9999 11.1 16.9999 10.7V10.1C16.9999 9.70001 16.5999 9.30001 16.1999 9.30001Z"
            fill=""
          />
          <path
            d="M9.00039 5.89941C7.10039 5.89941 5.60039 7.39941 5.60039 9.29941C5.60039 11.1994 7.10039 12.6994 9.00039 12.6994C10.9004 12.6994 12.4004 11.1994 12.4004 9.29941C12.4004 7.39941 10.9004 5.89941 9.00039 5.89941Z"
            fill=""
          />
        </svg>
      </Link>

      <div
        ref={dropdown}
        onFocus={() => setDropdownOpen(true)}
        onBlur={() => setDropdownOpen(false)}
        className={`absolute -right-16 mt-2.5 flex w-56 flex-col rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark sm:right-0 sm:w-56 ${
          dropdownOpen === true ? 'block' : 'hidden'
        }`}
      >
        <div className="px-4.5 py-3">
          <h5 className="text-sm font-medium text-bodydark2">Help & Info</h5>
        </div>

        <ul className="flex h-auto flex-col overflow-y-auto">
          <li>
            <Link
              className="flex items-center gap-3.5 border-t border-stroke px-6 py-4 hover:bg-gray-2 dark:border-strokedark dark:hover:bg-meta-4"
              to="/versions"
              onClick={() => setDropdownOpen(false)}
            >
              <svg
                className="fill-current"
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M17.6687 1.44374C17.1187 0.893744 16.4312 0.618744 15.675 0.618744H7.42498C6.25623 0.618744 5.25935 1.58124 5.25935 2.78437V4.12499H4.29685C3.88435 4.12499 3.50623 4.46874 3.50623 4.91562C3.50623 5.36249 3.84998 5.70624 4.29685 5.70624H5.25935V10.2781H4.29685C3.88435 10.2781 3.50623 10.6219 3.50623 11.0687C3.50623 11.4812 3.84998 11.8594 4.29685 11.8594H5.25935V16.4312H4.29685C3.88435 16.4312 3.50623 16.775 3.50623 17.2219C3.50623 17.6687 3.84998 18.0125 4.29685 18.0125H5.25935V19.25C5.25935 20.4187 6.22185 21.4156 7.42498 21.4156H15.675C17.2218 21.4156 18.4937 20.1437 18.5281 18.5969V3.47187C18.4937 2.68124 18.2187 1.95937 17.6687 1.44374ZM16.9469 18.5625C16.9469 19.2844 16.3625 19.8344 15.6406 19.8344H7.3906C7.04685 19.8344 6.77185 19.5594 6.77185 19.2156V17.875H8.6281C9.0406 17.875 9.41873 17.5312 9.41873 17.0844C9.41873 16.6375 9.07498 16.2937 8.6281 16.2937H6.77185V11.7906H8.6281C9.0406 11.7906 9.41873 11.4469 9.41873 11C9.41873 10.5875 9.07498 10.2094 8.6281 10.2094H6.77185V5.63749H8.6281C9.0406 5.63749 9.41873 5.29374 9.41873 4.84687C9.41873 4.39999 9.07498 4.05624 8.6281 4.05624H6.77185V2.74999C6.77185 2.40624 7.04685 2.13124 7.3906 2.13124H15.6406C15.9844 2.13124 16.2937 2.26874 16.5687 2.50937C16.8094 2.74999 16.9469 3.09374 16.9469 3.43749V18.5625Z"
                  fill=""
                />
              </svg>
              <span className="text-sm font-medium">Version History</span>
            </Link>
          </li>

          <li>
            <a
              className="flex items-center gap-3.5 border-t border-stroke px-6 py-4 hover:bg-gray-2 dark:border-strokedark dark:hover:bg-meta-4"
              href="mailto:david@clustersystems.com?subject=Commission Tracker Support Request"
            >
              <svg
                className="fill-current"
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M17.7778 1.77778H4.22222C2.98477 1.77778 1.97333 2.78922 1.97333 4.02667L1.96 17.7778C1.96 19.0152 2.98477 20.0267 4.22222 20.0267H17.7778C19.0152 20.0267 20.0267 19.0152 20.0267 17.7778V4.02667C20.0267 2.78922 19.0152 1.77778 17.7778 1.77778ZM17.7778 6.27556L11 10.8889L4.22222 6.27556V4.02667L11 8.64L17.7778 4.02667V6.27556Z"
                  fill=""
                />
              </svg>
              <span className="text-sm font-medium">Support</span>
            </a>
          </li>
        </ul>
      </div>
    </li>
  );
};

export default DropdownHelp;
